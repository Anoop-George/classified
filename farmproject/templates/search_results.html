{% extends "base.html" %}
{% block content %}


<h4 class="mb-3">Search Results</h4>

<!-- SORT BAR -->
<form method="get" class="mb-3">
 {% for key, value in request.GET.items %}
 {% if key != "sort" and key != "page" %}
 <input type="hidden" name="{{ key }}" value="{{ value }}">
 {% endif %}
 {% endfor %}

 <select name="sort" class="form-control w-25" onchange="this.form.submit()">
  <option value="new" {% if sort == "new" %}selected{% endif %}>Newest</option>
  <option value="old" {% if sort == "old" %}selected{% endif %}>Oldest</option>
  <option value="price_low" {% if sort == "price_low" %}selected{% endif %}>Price: Low → High</option>
  <option value="price_high" {% if sort == "price_high" %}selected{% endif %}>Price: High → Low</option>
 </select>
</form>

<!-- POSTS -->
{% for post in page_obj %}
<div class="card mb-3">
 <div class="card-body">
  <h5>{{ post.title }}</h5>
  <p>{{ post.district }} | {{ post.postcode }}</p>
  <strong>₹ {{ post.price }}</strong>
  <a href="{% url 'post_detail' post.pk %}" class="btn btn-sm btn-outline-primary float-right">
   View
  </a>
 </div>
</div>
{% empty %}
<p>No listings found.</p>
{% endfor %}

<!-- PAGINATION -->
<nav>
 <ul class="pagination">
  {% if page_obj.has_previous %}
  <li class="page-item">
   <a class="page-link" href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode }}">
    Previous
   </a>
  </li>
  {% endif %}

  <li class="page-item active">
   <span class="page-link">
    {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
   </span>
  </li>

  {% if page_obj.has_next %}
  <li class="page-item">
   <a class="page-link" href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode }}">
    Next
   </a>
  </li>
  {% endif %}
 </ul>
</nav>


{% endblock %}