{% extends "base.html" %}
{% load static %}

{% block content %}
<h1 class="mb-4">Latest Farm Ads</h1>

<form method="get" action="." class="form-inline mb-3">
  <input type="text" name="q" class="form-control mr-2" placeholder="Search..."
         value="{{ query|default:'' }}">
  <button type="submit" class="btn btn-primary">Search</button>
</form>

<!-- Filter form -->
<form method="get" action="{% url 'filtered_view' %}" class="form-row mb-4">
  <div class="col-md-3 mb-2">
    <input type="text" name="postcode" class="form-control" placeholder="Postcode"
           value="{{ postcode|default:'' }}">
  </div>
  <div class="col-md-3 mb-2">
    <input type="text" name="district" class="form-control" placeholder="District"
           value="{{ district|default:'' }}">
  </div>
  <div class="col-md-3 mb-2">
    <select name="category" class="form-control">
      <option value="">Category</option>
      <option value="fish">Fish</option>
      <option value="chicken">Chicken</option>
      <option value="duck">Duck</option>
      <option value="other_birds">Other Birds</option>
      <option value="cow">Cow</option>
      <option value="goat">Goat</option>
      <option value="buffalo">Buffalo</option>
      <option value="agri_produce">Agri Produce</option>
      <option value="seeds">Seeds</option>
      <option value="dogs">Dogs</option>
      <option value="cats">Cats</option>
      <option value="equipment">Equipment</option>
      <option value="other">Other</option>
    </select>
  </div>
  <div class="col-md-3 mb-2">
    <button type="submit" class="btn btn-secondary btn-block">Filter</button>
  </div>
</form>

<div class="row">
  {% for post in posts %}
    <div class="col-md-4 mb-3">
      <div class="card h-100">
        {% if post.images.all %}
          {% with img=post.images.first %}
            <img src="{{ img.image.url }}" class="card-img-top"
                 style="height:200px;object-fit:cover">
          {% endwith %}
        {% endif %}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ post.title }}</h5>
          <p class="card-text">
            {{ post.contents|truncatewords:20 }}
          </p>
          <p class="small text-muted mb-1">
            {{ post.get_category_display }} |
            {{ post.district }} ({{ post.postcode }})
          </p>
          <p class="small text-muted">Views: {{ post.view_count }}</p>
          <a href="{% url 'post_detail' post.pk %}" class="btn btn-primary mt-auto">
            View Details
          </a>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="col-12">
      <p>No posts found.</p>
    </div>
  {% endfor %}
</div>
{% endblock %}
